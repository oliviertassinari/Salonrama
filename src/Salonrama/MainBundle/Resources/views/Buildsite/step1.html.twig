{% set add_noscript = true %}

{% extends "SalonramaMainBundle:Main:main.html.twig" %}

{% block head %}
	<title>Etape 1 - Choix du thème</title>

	<link rel="stylesheet" href="{{ asset('bundles/salonramamain/buildsite/theme_select.css') }}"/>
	<link rel="stylesheet" href="{{ asset('bundles/salonramamain/buildsite/step.css') }}"/>
	<link rel="stylesheet" href="{{ asset('bundles/salonramamain/css/lightbox.css') }}"/>
{% endblock %}

{% block javascript %}
	<script src="{{ asset('bundles/salonramamain/js/lightbox.js') }}"></script>

	<script>

	var themeSelected;
	var lightbox;

	$(document).ready(function()
	{
		lightbox = new Lightbox({
			getDetailsCaption: function(title, imageNumber){
				return '<button type="button" onclick="setThemeFromLightbox('+imageNumber+')" class="button-small button-small-green"><i class="icon-ok"></i>Valider ce thème</button>';
			}
		});

		$('#themeSelect .themeSelectItem').each(function(){
			var item = $(this);
			var radio = item.find('.themeSelectItemRadio');
			radio.click(function(){ setTheme(item); });

			if(radio.find('input').prop('checked'))
			{
				themeSelected = item;
				themeSelected.addClass('select');
				setScroll(0);
			}
		});

		if(!document.getElementById('EtapeValide'))
		{
			document.getElementById('EtapeSuivant').onclick = submit;
		}
		else
		{
			document.getElementById('EtapeValide').onclick = submit;
		}
	});

	function setTheme(item)
	{
		themeSelected.removeClass('select');
		themeSelected = item;

		themeSelected.addClass('select');
		themeSelected.find('input').prop('checked', true);

		setScroll();
	}

	function setThemeFromLightbox(imageNumber)
	{
		lightbox.end();
		setTheme($($('#themeSelect .themeSelectItem')[imageNumber]));
		submit();
	}

	function setScroll(duration)
	{
		var duration = (typeof duration == 'number') ? duration : 'fast';
		var scrollTop = $('#themeSelect').scrollTop();

		var heightHiddenTop = $('#themeSelect').offset().top + 10 - themeSelected.offset().top;
		var heightHiddenBottom = themeSelected.height() - $('#themeSelect').height() - heightHiddenTop + 25;

		if(heightHiddenTop > 0)
		{
			$('#themeSelect').animate({  
				scrollTop: $('#themeSelect').scrollTop() - heightHiddenTop
			}, duration);
		}
		else if(heightHiddenBottom > 0)
		{
			$('#themeSelect').animate({  
				scrollTop: $('#themeSelect').scrollTop() + heightHiddenBottom
			}, duration);
		}
	}

	function submit()
	{
		$('#themeSelect form').submit();
	}

	</script>
{% endblock %}

{% block body %}
	{% autoescape false %}
	{{ storyboard }}
	{% endautoescape %}

	<h1>Etape 1 - Choix du thème</h1>

	{% if message %}
	<div class="cadre-small cadre-small-green">
		<i class="icon-ok"></i>{{ message }}
	</div>
	{% endif %}

	<div class="cadre-small cadre-small-orange">
		<i class="icon-info-sign"></i>Vous pourrez changer le thème plus tard s'il ne vous convient plus.
	</div>

	<h3>Liste des thèmes :</h3>

	<div id="themeSelect">
	<form method="post" action="">
		{% for value in theme %}
		<div class="themeSelectItem">
			<a href="{{ asset('bundles/salonramamain/theme/' ~ value.name ~ '/screenshot_max.jpg') }}" data-lightbox="theme-select" class="lightboxLink">
				<img src="{{ asset('bundles/salonramamain/theme/' ~ value.name ~ '/screenshot_min.jpg') }}" width="130" height="115"/>
				<span class="lightboxNotif" title="Agrandir cette image"></span>
			</a>
			<div class="themeSelectItemRadio">
				<input type="radio" name="site-theme" value="{{ value.name }}" id="{{ value.name }}"{% if theme_current == value.name %} checked="checked"{% endif %}/>
				<label for="{{ value.name }}">Sélectionner</label>
			</div>
		</div>
		{% endfor %}

		<button type="submit" style="display:none;">Submit</button>
	</form>
	</div>

	{% autoescape false %}
	{{ foot }}
	{% endautoescape %}
{% endblock %}